<!DOCTYPE html>

<html>
<head>
  <title>wormhole.litcoffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="cube.html">
                cube.litcoffee
              </a>
            
              
              <a class="source" href="fire.html">
                fire.litcoffee
              </a>
            
              
              <a class="source" href="starfield.html">
                starfield.litcoffee
              </a>
            
              
              <a class="source" href="wormhole.html">
                wormhole.litcoffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>wormhole.litcoffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wormhole</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@ctx</span>, <span class="hljs-property">@xsize</span>, <span class="hljs-property">@ysize</span>)</span> -&gt;</span>
    <span class="hljs-property">@spokes</span> = <span class="hljs-number">1600</span>
    <span class="hljs-property">@divs</span> = <span class="hljs-property">@spokes</span> / <span class="hljs-number">2</span>

    <span class="hljs-property">@dx</span> = <span class="hljs-number">0</span>
    <span class="hljs-property">@dy</span> = <span class="hljs-number">0</span>

    <span class="hljs-property">@spokeCosCalc</span> = <span class="hljs-keyword">new</span> Array <span class="hljs-property">@spokes</span>
    <span class="hljs-property">@spokeSinCalc</span> = <span class="hljs-keyword">new</span> Array <span class="hljs-property">@spokes</span>
    <span class="hljs-property">@initTables</span>()

    <span class="hljs-property">@imageData</span> = <span class="hljs-property">@ctx</span>.getImageData <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-property">@xsize</span>, <span class="hljs-property">@ysize</span>
    buf = <span class="hljs-keyword">new</span> ArrayBuffer <span class="hljs-property">@imageData</span>.data.length
    <span class="hljs-property">@buf8</span> = <span class="hljs-keyword">new</span> Uint8ClampedArray buf
    <span class="hljs-property">@data</span> = <span class="hljs-keyword">new</span> Uint32Array buf

    <span class="hljs-property">@fpsCounter</span> = <span class="hljs-keyword">new</span> FpsCounter <span class="hljs-number">1000</span>
    <span class="hljs-property">@fpsCounter</span>.start()

    <span class="hljs-property">@request</span> = <span class="hljs-built_in">window</span>.requestAnimationFrame <span class="hljs-property">@drawFrame</span>

  <span class="hljs-attribute">initTables</span>: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0</span> .. <span class="hljs-property">@spokes</span> - <span class="hljs-number">1</span>]
      sc = <span class="hljs-number">2</span> * Math.PI * i / <span class="hljs-property">@spokes</span>
      <span class="hljs-property">@spokeCosCalc</span>[i] = Math.cos sc
      <span class="hljs-property">@spokeSinCalc</span>[i] = Math.sin sc

  <span class="hljs-attribute">stop</span>: <span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@fpsCounter</span>.stop()
    <span class="hljs-built_in">window</span>.cancelAnimationFrame <span class="hljs-property">@request</span>
    <span class="hljs-property">@request</span> = <span class="hljs-literal">undefined</span>

  <span class="hljs-attribute">drawFrame</span>: <span class="hljs-function">=&gt;</span>
    <span class="hljs-property">@request</span> = <span class="hljs-built_in">window</span>.requestAnimationFrame <span class="hljs-property">@drawFrame</span>

    <span class="hljs-property">@ctx</span>.fillStyle = <span class="hljs-string">"black"</span>
    <span class="hljs-property">@ctx</span>.fillRect <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-property">@xsize</span>, <span class="hljs-property">@ysize</span>

    <span class="hljs-property">@dx</span> = (<span class="hljs-property">@dx</span> + <span class="hljs-number">1</span>) % <span class="hljs-number">40</span>
    <span class="hljs-property">@dy</span> = (<span class="hljs-property">@dy</span> + <span class="hljs-number">1</span>) % <span class="hljs-number">40</span>

    xcenter = <span class="hljs-number">5</span> * <span class="hljs-property">@xsize</span> / <span class="hljs-number">8</span>
    ycenter = <span class="hljs-property">@ysize</span> / <span class="hljs-number">4</span>

    <span class="hljs-keyword">for</span> _, i <span class="hljs-keyword">in</span> <span class="hljs-property">@data</span>
      <span class="hljs-property">@data</span>[i] = <span class="hljs-number">0xff000000</span>

    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> [<span class="hljs-number">0</span> .. <span class="hljs-property">@divs</span> - <span class="hljs-number">1</span>]
      z = -<span class="hljs-number">1.0</span> + Math.log(<span class="hljs-number">2.0</span> * j / <span class="hljs-property">@divs</span>)
      divCalcX = <span class="hljs-property">@xsize</span> * j / <span class="hljs-property">@divs</span>
      divCalcY = <span class="hljs-property">@ysize</span> * j / <span class="hljs-property">@divs</span>
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0</span> .. <span class="hljs-property">@spokes</span> - <span class="hljs-number">1</span>]
        x = divCalcX * <span class="hljs-property">@spokeCosCalc</span>[i]
        y = divCalcY * <span class="hljs-property">@spokeSinCalc</span>[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>this creates the downward curve in the center</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        y = y - <span class="hljs-number">25</span> * z</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>start circling outwards from center</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        x += xcenter
        y += ycenter

        x |= <span class="hljs-number">0</span>
        y |= <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>only place pixels within the range of the wormImg resolution</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= x) &amp;&amp; (x &lt; <span class="hljs-property">@xsize</span>) &amp;&amp; (<span class="hljs-number">0</span> &lt;= y) &amp;&amp; (y &lt; <span class="hljs-property">@ysize</span>)
          texturex = ((i / <span class="hljs-number">8</span>) % <span class="hljs-number">40</span>) | <span class="hljs-number">0</span>
          texturey = ((j / <span class="hljs-number">6</span>) % <span class="hljs-number">40</span>) | <span class="hljs-number">0</span>
          index = y * <span class="hljs-property">@xsize</span> + x
          <span class="hljs-keyword">if</span> (texturex % <span class="hljs-number">20</span> == <span class="hljs-property">@dx</span> % <span class="hljs-number">20</span>) || (texturey % <span class="hljs-number">20</span> == <span class="hljs-property">@dy</span> % <span class="hljs-number">20</span>)
            <span class="hljs-property">@data</span>[index] = <span class="hljs-number">0xffffffff</span>

    <span class="hljs-property">@imageData</span>.data.set <span class="hljs-property">@buf8</span>
    <span class="hljs-property">@ctx</span>.putImageData <span class="hljs-property">@imageData</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>

    fpsText = <span class="hljs-property">@fpsCounter</span>.tick()
    <span class="hljs-property">@ctx</span>.fillStyle = <span class="hljs-string">"red"</span>
    <span class="hljs-property">@ctx</span>.fillText fpsText, <span class="hljs-number">10</span>, <span class="hljs-number">10</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
